
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic meta -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>World Cup 2026 Map • MatchDay Navigator</title>

  <!-- Page‑scoped CSP to allow Leaflet CDN + OSM tiles -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' data: https:;
                 style-src 'self' 'unsafe-inline' https://unpkg.com;
                 script-src 'self' https://unpkg.com;
                 connect-src 'self';
                 child-src 'none';
                 frame-ancestors 'none'">

  <!-- ✅ REAL TAGS (NOT PLAIN TEXT): Leaflet & MarkerCluster CSS -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous" />
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

  <style>
    :root { --navy:#0a3d62; --blue:#1e90ff; --border:#e5e7eb; --text:#223; }
    body { margin:0; font-family:Arial,system-ui,sans-serif; color:var(--text); }
    header { background:var(--navy); color:#fff; padding:16px 20px; }
    header h1 { margin:0; font-size:20px; }
    .note { font-size:12px; color:#e6eef7; margin-top:4px; }
    .wrap { display:grid; grid-template-columns: 1fr 340px; height:calc(100vh - 64px); }
    #map { height:100%; width:100%; }
    aside { border-left:1px solid var(--border); overflow:auto; background:#fff; }
    .panel { padding:14px 16px; }
    h2 { margin:10px 0 6px; font-size:16px; color:var(--navy); }
    .city, .stadium { margin:6px 0; }
    .city a, .stadium a { text-decoration:none; color:var(--blue); }
    .city a:hover, .stadium a:hover { text-decoration:underline; }
    .hint { font-size:12px; color:#555; margin-top:8px; }
    @media (max-width: 900px) { .wrap { grid-template-columns:1fr; } aside { height:42vh; } #map { height:58vh; } }
  </style>
</head>
<body>
  <header>
    <h1>FIFA World Cup 2026 • Host Cities & Stadiums</h1>
    <div class="note">Explore host cities and venues across USA, Canada, and Mexico. Click a pin for details; use the sidebar to navigate.</div>
  </header>

  <div class="wrap">
    <div id="map"></div>
    <aside>
      <div class="panel">
        <h2>Cities</h2>
        <div id="cityList"></div>
        <h2>Stadiums</h2>
        <div id="stadiumList"></div>
        <p class="hint">City markers use stadium coordinates for precise centering (change to downtown later if you prefer).</p>
      </div>
    </aside>
  </div>

  <!-- ✅ REAL TAGS (NOT PLAIN TEXT): Leaflet & MarkerCluster JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin="anonymous"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <script>
    const map = L.map('map', { zoomControl:true });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    map.setView([37.8, -96], 4); // North America

    const cityCluster = L.markerClusterGroup({ showCoverageOnHover:false, maxClusterRadius:50 });
    const stCluster   = L.markerClusterGroup({ showCoverageOnHover:false, maxClusterRadius:50 });
    map.addLayer(cityCluster);
    map.addLayer(stCluster);

    function addCity(city) {
      // Sidebar entry
      const list = document.getElementById('cityList');
      const el = document.createElement('div');
      el.className = 'city';
      el.innerHTML = `<a href="./city.html?id=${city.slug}">${city.name} — ${city.country}</a>`;
      list.appendChild(el);

      // Marker
      if (city.lat != null && city.lng != null) {
        const m = L.marker([city.lat, city.lng]).bindPopup(
          `<b>${city.name}</b><br/>${city.country}<br/>` +
          `<a href="./city.html?id=${city.slug}">Open city page</a>`
        );
        cityCluster.addLayer(m);
      }
    }

    function addStadium(st) {
      // Sidebar entry
      const list = document.getElementById('stadiumList');
      const el = document.createElement('div');
      el.className = 'stadium';
      el.innerHTML = `<a href="./stadium.html?id=${st.slug}">${st.name}</a>`;
      list.appendChild(el);

      // Marker + popup (Official / Route / WhatsApp)
      if (st.lat != null && st.lng != null) {
        const waText = encodeURIComponent(`Hi, I'd like match‑day details for ${st.name}.`);
        const popup = `
          <b>${st.name}</b><br/>
          <a href="${st.official_url}" target="_blank" rel="noopener">Official site</a><br/>
          <a href="https://concierge.matchdaynavigator.com/route?stadium=${encodeURIComponent(st.name)}" target="_blank" rel="noopener">Open route</a><br/>
          <a href="https://wa.me/14155238886?text=${waText}" target="_blank" rel="noopener">Get match‑day details on WhatsApp</a>
          <br/><small>(Replace number with your WABA, or link to your own opt‑in page.)</small>
        `;
        stCluster.addLayer(L.marker([st.lat, st.lng]).bindPopup(popup));
      }
    }

    async function loadData() {
      const [cRes, sRes] = await Promise.all([
        fetch('/assets/data/cities.json'),
        fetch('/assets/data/stadiums.json')
      ]);
      const cData = await cRes.json();
      const sData = await sRes.json();
      (cData.cities   || []).forEach(addCity);
      (sData.stadiums || []).forEach(addStadium);
    }

    loadData().catch(err => {
      console.error('Data load error', err);
      alert('Could not load data. Check that /assets/data/*.json exist at those exact paths and are not 404.');
    });
  </script>
</body>
</html>
