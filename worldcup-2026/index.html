
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic meta -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>World Cup 2026 Map • MatchDay Navigator</title>

  <!-- Page‑scoped CSP to allow Leaflet CDN + OSM tiles -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; img-src 'self' data: https:;
                 style-src 'self' 'unsafe-inline' https://unpkg.com;
                 script-src 'self' https://unpkg.com;
                 connect-src 'self'; child-src 'none'; frame-ancestors 'none'">

  <!-- Leaflet CSS -->
  https://unpkg.com/leaflet@1.9.4/dist/leaflet.css

  <!-- MarkerCluster CSS -->
  https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css
  https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css

  <style>
    :root { --navy:#0a3d62; --blue:#1e90ff; --border:#e5e7eb; --text:#223; }
    body { margin:0; font-family:Arial,system-ui,sans-serif; color:var(--text); }
    header { background:var(--navy); color:#fff; padding:16px 20px; }
    header h1 { margin:0; font-size:20px; }
    .note { font-size:12px; color:#e6eef7; margin-top:4px; }
    .wrap { display:grid; grid-template-columns: 1fr 340px; gap:0; height:calc(100vh - 64px); }
    #map { height:100%; width:100%; }
    aside { border-left:1px solid var(--border); overflow:auto; background:#fff; }
    .panel { padding:14px 16px; }
    h2 { margin:10px 0 6px; font-size:16px; color:var(--navy); }
    .city, .stadium { margin:6px 0; }
    .city a, .stadium a { text-decoration:none; color:var(--blue); }
    .city a:hover, .stadium a:hover { text-decoration:underline; }
    .hint { font-size:12px; color:#555; margin-top:8px; }
    @media (max-width: 900px) {
      .wrap { grid-template-columns: 1fr; }
      aside { height:42vh; }
      #map { height:58vh; }
    }
  </style>
</head>
<body>
  <header>
    <h1>FIFA World Cup 2026 • Host Cities & Stadiums</h1>
    <div class="note">Explore host cities and venues across USA, Canada, and Mexico. Click a pin for details; use the sidebar to navigate.</div>
  </header>

  <div class="wrap">
    <div id="map"></div>
    <aside>
      <div class="panel">
        <h2>Cities</h2>
        <div id="cityList"></div>
        <h2>Stadiums</h2>
        <div id="stadiumList"></div>
        <p class="hint">City markers use stadium coordinates for precise centering (change to downtown later if you prefer).</p>
      </div>
    </aside>
  </div>

  <!-- Leaflet JS -->
  https://unpkg.com/leaflet@1.9.4/dist/leaflet.js</script>

  <!-- MarkerCluster JS -->
  https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js</script>

  <script>
    const map = L.map('map', { zoomControl: true });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    map.setView([37.8, -96], 4); // North America

    const cityCluster = L.markerClusterGroup({ showCoverageOnHover:false, maxClusterRadius:50 });
    const stCluster   = L.markerClusterGroup({ showCoverageOnHover:false, maxClusterRadius:50 });
    map.addLayer(cityCluster);
    map.addLayer(stCluster);

    const mkInt = (href, label) => `${href}${label}</a>`;
    const mkExt = (href, label) => `${href}${label}</a>`;

    function addCity(city) {
      const list = document.getElementById('cityList');
      const el = document.createElement('div');
      el.className = 'city';
      el.innerHTML = mkInt(`./city.html?id=${city.slug}`, `${city.name} — ${city.country}`);
      list.appendChild(el);

      if (city.lat != null && city.lng != null) {
        const m = L.marker([city.lat, city.lng]).bindPopup(
          `<b>${city.name}</b><br/>${city.country}<br/>` +
          mkInt(`./city.html?id=${city.slug}`, 'Open city page')
        );
        cityCluster.addLayer(m);
      }
    }

    function addStadium(st) {
      const list = document.getElementById('stadiumList');
      const el = document.createElement('div');
      el.className = 'stadium';
      el.innerHTML = mkInt(`./stadium.html?id=${st.slug}`, st.name);
      list.appendChild(el);

      if (st.lat != null && st.lng != null) {
        const waText = encodeURIComponent(`Hi, I'd like match‑day details for ${st.name}.`);
        const html = `
          <b>${st.name}</b><br/>
          ${mkExt(st.official_url, 'Official site')}<br/>
          ${mkExt('https://concierge.matchdaynavigator.com/route?stadium=' + encodeURIComponent(st.name), 'Open route')}<br/>
          ${mkExt('https://wa.me/14155238886?text=' + waText, 'Get match‑day details on WhatsApp')}
          <br/><small>(Pre‑filled WhatsApp message; replace with your WABA number or your own opt‑in page.)</small>
        `;
        const m = L.marker([st.lat, st.lng]).bindPopup(html);
        stCluster.addLayer(m);
      }
    }

    async function loadData() {
      const [cRes, sRes] = await Promise.all([
        fetch('/assets/data/cities.json'),
        fetch('/assets/data/stadiums.json')
      ]);
      const cData = await cRes.json();
      const sData = await sRes.json();
      (cData.cities   || []).forEach(addCity);
      (sData.stadiums || []).forEach(addStadium);
    }

    loadData().catch(err => {
      console.error('Data load error', err);
      alert('Could not load data. Check /assets/data paths and CSP.');
    });
  </script>
</body>
</html>
