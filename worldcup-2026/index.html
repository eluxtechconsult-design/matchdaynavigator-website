<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MatchDay Navigator • World Cup 2026 (Single‑file Proof)</title>

  <!-- Leaflet CSS (CDN) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4WxkYVzw9M86gMm7zGv0XvS+T1CkHkYhYBf8Q8b+0o="
    crossorigin=""
  />

  <style>
    :root { --bg:#0b0e12; --text:#dfe7f3; --line:#1c2430; }
    * { box-sizing:border-box; }
    html, body { height:100%; margin:0; }
    body { background:var(--bg); color:var(--text); font:14px/1.4 system-ui, Arial, sans-serif; }
    header.top { height:56px; display:flex; align-items:center; padding:8px 14px; border-bottom:1px solid var(--line); background:#0d1117; }
    header .brand { font-weight:700; color:#eaf2ff; }
    /* Fill the rest of the viewport */
    main { height: calc(100vh - 56px); }
    #map { width:100%; height:100%; background:#000; }
    /* Dark UI for Leaflet widgets */
    .leaflet-control-zoom a { background:#0f141c; color:#cfe5ff; border:1px solid #1a2230; }
    .leaflet-popup-content-wrapper { background:#0f141c; color:#eaf2ff; border:1px solid #1a2230; }
    .leaflet-popup-tip { background:#0f141c; }
    .leaflet-tooltip { background:#0f141c; color:#cfe5ff; border:1px solid #1a2230; }
  </style>
</head>
<body>
  <header class="top">
    <div class="brand">MatchDay Navigator</div>
  </header>

  <main>
    <div id="map" aria-label="World Cup 2026 Map"></div>
  </main>

  <!-- Leaflet JS (CDN) -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="">
  </script>

  <script>
    // --- Map init (Dark Matter) ---
    const map = L.map('map', { zoomControl:true, worldCopyJump:true });
    L.tileLayer(
      'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
      { attribution:'&copy; OpenStreetMap contributors &copy; CARTO', subdomains:'abcd', maxZoom:20 }
    ).addTo(map);

    // --- Simple SVG pin (city=blue, stadium=gold) ---
    const svgPin = (fill, stroke='#0a3d62') => {
      const svg = `
        <svg xmlns='http://www.w3.org/2000/svg' width='25' height='41' viewBox='0 0 25 41'>
          <path d='M12.5 0C5.6 0 0 5.6 0 12.5c0 9.2 10.6 17.2 11.2 17.7a2 2 0 0 0 2.6 0C14.4 29.7 25 21.7 25 12.5 25 5.6 19.4 0 12.5 0z'
                fill='${fill}' stroke='${stroke}' stroke-width='1'/>
          <circle cx='12.5' cy='12.5' r='5' fill='#fff'/>
        </svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    };
    const ICONS = {
      city:    L.icon({ iconUrl: svgPin('#1e90ff'), iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[0,-36] }),
      stadium: L.icon({ iconUrl: svgPin('#f7d354'), iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[0,-36] })
    };

    // --- Fallback data so the page shows pins even with no JSON yet ---
    const FALLBACK_CITIES = { cities: [
      { name:'New York / New Jersey', country:'USA', lat:40.813528, lng:-74.074361 },
      { name:'Dallas (Arlington)',    country:'USA', lat:32.747780, lng:-97.092780 },
      { name:'Houston',               country:'USA', lat:29.684720, lng:-95.410830 },
      { name:'Kansas City',           country:'USA', lat:39.048890, lng:-94.483890 },
      { name:'Atlanta',               country:'USA', lat:33.755560, lng:-84.400000 },
      { name:'Los Angeles',           country:'USA', lat:33.953000, lng:-118.339000 },
      { name:'Toronto',               country:'Canada', lat:43.633330, lng:-79.418610 },
      { name:'Vancouver',             country:'Canada', lat:49.276684, lng:-123.112404 },
      { name:'Mexico City',           country:'Mexico', lat:19.303060, lng:-99.150560 },
      { name:'Guadalajara',           country:'Mexico', lat:20.681670, lng:-103.462780 },
      { name:'Monterrey',             country:'Mexico', lat:25.669170, lng:-100.244440 }
    ]};

    (async () => {
      // Try your live data first; fallback if not present.
      async function getJSON(url, fb) {
        try { const r = await fetch(url, { cache:'no-store' }); if(!r.ok) throw 0; return await r.json(); }
        catch { return fb; }
      }
      const cities = (await getJSON('/assets/data/cities.json', FALLBACK_CITIES)).cities || [];

      // Add markers
      const markers = [];
      cities.forEach(c => {
        if (c.lat == null || c.lng == null) return;
        const m = L.marker([c.lat, c.lng], { icon: ICONS.city })
          .bindPopup(`<b>${c.name}</b><br/>${c.country}`)
          .bindTooltip(c.name);
        m.addTo(map);
        markers.push(m);
      });

      // Fit to pins
      if (markers.length) {
        const fg = L.featureGroup(markers);
        map.fitBounds(fg.getBounds(), { padding:[40,40] });
      } else {
        map.setView([37.8, -96], 4);
      }

      // Critical to remove “patchy tiles” after first paint + on resize
      requestAnimationFrame(() => map.invalidateSize());
      window.addEventListener('resize', () => map.invalidateSize());
    })();
  </script>
</body>
</html>